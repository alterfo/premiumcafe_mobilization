//*************************************************************************************************
// Rio3D Image Viewer 0.2.1
//*************************************************************************************************
(function(window,$){$(function(){var a=false,b,c,d,e,f=false,g=false,h,i,j,k,l,m,n,o,p,q,r,s,t;var u={container:$("body"),markup:'<div id="viewer-bg"></div>'+'<div id="viewer">'+'<div class="wrapper current"></div>'+'<div class="wrapper loading"></div>'+'<div class="wrapper next"></div>'+'<div class="title"></div>'+'<div class="button fullscreen"></div>'+'<div class="button prev"></div>'+'<div class="button next"></div>'+'<div class="button close"></div>'+"</div>",speed:"slow",easing:"swing",event:"click"};$.fn.imageViewer=function(g){if(!C()||!$(this).is(jQuery)||$(this).size()==0){return false}b=$.extend({},u,g);if(!a){a=true;b.container.append(b.markup);d=$("#viewer");e=$("#viewer-bg");r=A(d);t=$.extend({},r);d.children(".wrapper.next, .button.next").bind("click",function(){w()});d.children(".button.prev").bind("click",function(){x()});d.children(".button.fullscreen").bind("click",function(){y()});d.children(".button.close").add(e).bind("click",function(){z()});d.add(e).bind("mousewheel",function(a,b,c,d){if(f){if(b<0){w()}else{x()}return false}});$(document).bind("keyup",function(a){if(f){if($.inArray(a.keyCode,[38,39,13,32])!==-1){w()}else if($.inArray(a.keyCode,[37,40])!==-1){x()}else if(a.keyCode==70){y()}else if(a.keyCode==27){z()}return false}});$(document).bind("keypress",function(){if(f){return false}});$(document).bind("keydown",function(){if(f){return false}})}c=$(this);h=c.find("img");i=c.children();j=null;k=null;l=0;m="";n="";s=h.size();if(s>0){c.delegate(i.get(0).localName,b.event,function(){l=$(this).index();if($(this).is("img")){j=$(this)}else{j=$(this).find("img")}v(j);return false})}};var v=function(a){n=m;e.fadeTo(b.speed,.7);if(typeof a=="number"){j=h.eq(a)}g=true;$(".wrapper.loading",d).fadeTo("fast",.7);if(j.parent().is("a")){m=j.parent().attr("href")}else{m=j.attr("src").replace("thumbs/","")}$("<img />").bind("load",function(){k.attr("src",m);$(".wrapper.loading",d).dequeue().fadeTo("fast",0)}).attr("src",m);o=A(j,true);p=A(d,true);q=B(j,r,true);$.extend(q,{left:"50%",top:"50%",marginLeft:-q.width/2,marginTop:-q.height/2});if(!f){k=j.clone().attr("id","viewer-animator").css({position:"fixed"}).appendTo(b.container).css(o).animate(q,b.speed,b.easing,function(){g=false;f=true;d.addClass("open");$(this).removeAttr("id").css({position:"",left:"",top:"",margin:"",width:"",height:""}).appendTo($(".current",d))});d.animate(q,b.speed,b.easing)}else{k=j.clone();$(".wrapper.next",d).empty().append(k).dequeue().animate({opacity:1},b.speed);d.dequeue().animate(q,b.speed,b.easing,function(){k.appendTo($(".current",d).empty());$(".wrapper.next",d).empty().css({opacity:0})})}if(n!==m){$(".title",d).dequeue().fadeTo(b.speed,0,function(){$(this).html(j.attr("alt"));if($(this).text()!=="")$(this).fadeTo(b.speed,1)})}};var w=function(){l=l==s-1?0:l+1;j=h.eq(l);v(j)};var x=function(){l=l==0?s-1:l-1;j=h.eq(l);v(j)};var y=function(){if(f){if(d.hasClass("fullscreen")){r=t;d.removeClass("fullscreen")}else{r=A($("#viewer-bg"));d.addClass("fullscreen")}q=B(j,r,true);d.dequeue().animate(q,b.speed,b.easing)}};var z=function(){o=A(j,true);p=A(d,true);$.extend(o,{opacity:0});g=true;$(".current img",d).appendTo(b.container).attr("id","viewer-animator").css("position","fixed").css(p).animate(o,b.speed,function(){g=false;$(this).remove()});f=false;d.removeClass("open fullscreen");r=t;e.fadeOut(b.speed)};var A=function(a,b){var c=Math.round(a.width()),d=Math.round(a.height()),e=a.offset(),f=$(document).scrollLeft(),g=$(document).scrollTop(),h=$(window).width(),i=$(window).height();return{width:Math.round(c),height:Math.round(d),left:Math.round((e.left-f)*(b?100/h:1))+(b?"%":0),top:Math.round((e.top-g)*(b?100/i:1))+(b?"%":0),marginLeft:0,marginTop:0}};var B=function(a,b,c){var d=A(a);var e=d.width/d.height,f=b.width/b.height;var g=$.extend({},b);return $.extend(g,e>1&&e>=f?{marginTop:Math.round((b.height-(g.height=g.width/e))/2)}:{marginLeft:Math.round((b.width-(g.width=g.height*e))/2)})};var C=function(){var a=document.createElement("div"),b=a.cloneNode(false),c=false,d=document.body||function(){c=true;return document.documentElement.appendChild(document.createElement("body"))}();var e=d.style.cssText;d.style.cssText="padding:0;margin:0";a.style.cssText="position:fixed;top:42px";d.appendChild(a);d.appendChild(b);var f=a.offsetTop!==b.offsetTop;d.removeChild(a);d.removeChild(b);d.style.cssText=e;if(c){document.documentElement.removeChild(d)}return f}})})(this,jQuery);